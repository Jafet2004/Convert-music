<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convert Music</title>
    <link rel="icon" href="CM.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Welcome Animation -->
    <div id="welcome-animation">
        <div class="welcome-content">
            <div class="logo-animation">Convert-Music</div>
            <div class="loading-container">
                <div class="loading-bar"></div>
            </div>
        </div>
    </div>

    <!-- Mensaje de bienvenida -->
    <div id="welcome-message" class="welcome-message">
        <i class="fas fa-check-circle me-2"></i>
        <span id="welcome-text">Bienvenido de nuevo!</span>
    </div>

    <header class="main-header">
        <div class="container">
            <nav class="navbar navbar-expand-lg">
                <div class="container-fluid">
                    <a class="navbar-brand logo" href="#">
                        <span class="logo-text">Convert<span class="logo-highlight">Music</span></span>
                    </a>

                    <div class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <i class="fas fa-bars"></i>
                    </div>

                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav ms-auto">
                            <li class="nav-item">
                                <a class="nav-link active" href="index.html">
                                    <i class="fas fa-home me-2"></i>Inicio
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-tools me-2"></i>Herramientas
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="convert.html"><i
                                                class="fas fa-exchange-alt me-2"></i> Conversor de Tonalidades</a></li>
                                    <li><a class="dropdown-item" href="partitura.html"><i class="fas fa-music me-2"></i>
                                            Creación de Partituras</a></li>
                                    <li><a class="dropdown-item" href="Search_liryc.html"><i
                                                class="fas fa-search me-2"></i> Buscar Letras</a></li>
                                    <li><a class="dropdown-item" href="afinador.html"><i
                                                class="fas fa-sliders-h me-1"></i> Afinador Musical</a></li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a id="userBtn" class="btn btn-outline-light ms-lg-3" href="#">
                                    <i class="fas fa-user me-1"></i>
                                    <span class="d-none d-lg-inline">Iniciar Sesión</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <div id="darkModeToggle" class="btn btn-outline-light ms-lg-3">
                                    <i class="fas fa-moon me-1"></i>
                                    <span class="d-none d-lg-inline"></span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Modal de Login -->
    <div class="modal fade login-modal" id="loginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Iniciar Sesión</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginUsername" class="form-label">Nombre de Usuario</label>
                            <input type="text" class="form-control" id="loginUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-submit">
                            <i class="fas fa-sign-in-alt me-2"></i>Iniciar Sesión
                        </button>
                        <div class="form-footer">
                            <p>¿No tienes cuenta? <a href="#" id="showRegisterForm">Regístrate</a></p>
                        </div>
                    </form>

                    <form id="registerForm" style="display: none;">
                        <div class="mb-3">
                            <label for="firstName" class="form-label">Primer Nombre</label>
                            <input type="text" class="form-control" id="firstName" required>
                        </div>
                        <div class="mb-3">
                            <label for="lastName" class="form-label">Primer Apellido</label>
                            <input type="text" class="form-control" id="lastName" required>
                        </div>
                        <div class="mb-3">
                            <label for="username" class="form-label">Nombre de Usuario</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="email" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="birthDate" class="form-label">Fecha de Nacimiento</label>
                            <input type="date" class="form-control" id="birthDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-submit">
                            <i class="fas fa-user-plus me-2"></i>Registrarse
                        </button>
                        <div class="form-footer">
                            <p>¿Ya tienes cuenta? <a href="#" id="showLoginForm">Inicia Sesión</a></p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="floating-element floating-element-1"></div>
        <div class="floating-element floating-element-2"></div>
        <div class="container">
            <div class="hero-content">
                <h1>Transforma tu experiencia musical</h1>
                <p>Descubre herramientas profesionales diseñadas para músicos, compositores y amantes de la música.
                    Simplifica tu flujo de trabajo y lleva tu creatividad al siguiente nivel.</p>
                <a href="#herramientas" class="btn btn-primary">
                    Explorar herramientas <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
    </section>

    <!-- Tools Section -->
    <section id="herramientas" class="section-tools">
        <div class="container">
            <h2 class="section-title">Nuestras Herramientas</h2>
            <p class="section-subtitle">Diseñadas para satisfacer todas tus necesidades musicales</p>

            <div class="row g-4">
                <!-- Conversor de Tonalidades -->
                <div class="col-lg-4 col-md-6">
                    <div class="tool-card">
                        <div class="tool-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <h3 class="tool-title">Conversor de Tonalidades</h3>
                        <p class="tool-description">Adapta fácilmente las tonalidades entre diferentes instrumentos y
                            explora todas las escalas musicales disponibles.</p>
                        <ul class="tool-features">
                            <li>Soporte para múltiples instrumentos</li>
                            <li>Visualización interactiva de escalas</li>
                            <li>Historial de conversiones</li>
                        </ul>
                        <a href="convert.html" class="tool-link">
                            Usar herramienta <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>

                <!-- Editor de Partituras -->
                <div class="col-lg-4 col-md-6">
                    <div class="tool-card">
                        <div class="tool-icon">
                            <i class="fas fa-music"></i>
                        </div>
                        <h3 class="tool-title">Editor de Partituras</h3>
                        <p class="tool-description">Crea, edita y comparte partituras profesionales con nuestra interfaz
                            intuitiva y potentes herramientas.</p>
                        <ul class="tool-features">
                            <li>Notación musical completa</li>
                            <li>Exportación en múltiples formatos</li>
                            <li>Colaboración en tiempo real</li>
                        </ul>
                        <a href="partitura.html" class="tool-link">
                            Crear partitura <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>

                <!-- Afinador Musical -->
                <div class="col-lg-4 col-md-6">
                    <div class="tool-card tuner-card">
                        <div class="tool-icon">
                            <i class="fas fa-sliders-h me-1"></i>
                        </div>
                        <h3 class="tool-title">Afinador Musical</h3>
                        <p class="tool-description">Afinación precisa para guitarra, violín y bajo con detección de
                            frecuencia en tiempo real.</p>

                        <div class="tuner-preview-content">
                            <div class="tuner-note-preview">--</div>
                            <div class="tuner-visual-preview">
                                <div class="tuner-scale-preview"></div>
                                <div class="tuner-needle-preview"></div>
                            </div>
                            <div class="tuner-accuracy-preview">
                                <div class="tuner-accuracy-marker"></div>
                            </div>

                            <div class="tuner-strings-preview">
                                <div class="tuner-string-preview">6ª <span class="tuner-string-note">E</span></div>
                                <div class="tuner-string-preview">5ª <span class="tuner-string-note">A</span></div>
                                <div class="tuner-string-preview">4ª <span class="tuner-string-note">D</span></div>
                                <div class="tuner-string-preview">3ª <span class="tuner-string-note">G</span></div>
                                <div class="tuner-string-preview">2ª <span class="tuner-string-note">B</span></div>
                                <div class="tuner-string-preview">1ª <span class="tuner-string-note">E</span></div>
                            </div>

                            <div class="tuner-status-preview">Selecciona una cuerda para afinar</div>
                        </div>

                        <ul class="tool-features">
                            <li>Precisión profesional (±0.5 Hz)</li>
                            <li>Soporte para múltiples instrumentos</li>
                            <li>Visualización intuitiva</li>
                        </ul>
                        <a href="afinador.html" class="tool-link">
                            Usar afinador <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>

                <!-- Buscador de Letras -->
                <div class="col-lg-4 col-md-6">
                    <div class="tool-card">
                        <div class="tool-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3 class="tool-title">Buscador de Letras</h3>
                        <p class="tool-description">Encuentra las letras de tus canciones favoritas y descubre nueva
                            música con nuestra extensa base de datos.</p>
                        <ul class="tool-features">
                            <li>Millones de canciones indexadas</li>
                            <li>Búsqueda por artista o título</li>
                            <li>Letras con acordes incluidos</li>
                        </ul>
                        <a href="Search_liryc.html" class="tool-link">
                            Buscar letras <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-5 mb-lg-0">
                    <div class="footer-logo">ConvertMusic</div>
                    <p class="footer-description">Tu plataforma integral para todas las herramientas musicales que
                        necesitas, en un solo lugar.</p>
                </div>
                <div class="col-lg-2 col-md-4 mb-4 mb-md-0">
                    <h4 class="footer-links-title">Navegación</h4>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-chevron-right"></i> Inicio</a></li>
                        <li><a href="#herramientas"><i class="fas fa-chevron-right"></i> Herramientas</a></li>
                        <li><a href="about.html"><i class="fas fa-chevron-right"></i> Acerca de</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-4 mb-4 mb-md-0">
                    <h4 class="footer-links-title">Herramientas</h4>
                    <ul class="footer-links">
                        <li><a href="convert.html"><i class="fas fa-chevron-right"></i> Conversor</a></li>
                        <li><a href="partitura.html"><i class="fas fa-chevron-right"></i> Partituras</a></li>
                        <li><a href="afinador.html"><i class="fas fa-chevron-right"></i> Afinador</a></li>
                        <li><a href="Search_liryc.html"><i class="fas fa-chevron-right"></i> Letras</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-4">
                    <h4 class="footer-links-title">Contacto</h4>
                    <ul class="footer-links">
                        <li><a href="mailto:jafetalexander58@gmail.com"><i class="fas fa-envelope"></i> Email</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 ConvertMusic. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script_ind.js"></script>
</script>
    <script src="script_ind.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 1. Simulación de afinador con soporte táctil
            const tunerCards = document.querySelectorAll('.tuner-card');
            tunerCards.forEach(card => {
                const noteDisplay = card.querySelector('.tuner-note-preview');
                const needle = card.querySelector('.tuner-needle-preview');
                const accuracyMarker = card.querySelector('.tuner-accuracy-marker');
                const statusDisplay = card.querySelector('.tuner-status-preview');
                const strings = card.querySelectorAll('.tuner-string-preview');

                const handleTunerInteraction = (event) => {
                    event.preventDefault();
                    const note = event.currentTarget.querySelector('.tuner-string-note').textContent;
                    noteDisplay.textContent = note;
                    noteDisplay.classList.remove('tuner-in-tune');

                    const randomOffset = (Math.random() * 100 - 50);
                    const needlePosition = 50 + (randomOffset / 50 * 25);
                    needle.style.transform = `translateX(-50%) translateX(${Math.min(Math.max(needlePosition - 50, -40), 40)}px)`;

                    const accuracyPosition = 50 + (randomOffset / 50 * 25);
                    accuracyMarker.style.left = `${Math.min(Math.max(accuracyPosition, 5), 95)}%`;

                    if (Math.abs(randomOffset) < 5) {
                        accuracyMarker.style.backgroundColor = 'var(--correct-color)';
                        statusDisplay.textContent = 'Perfectamente afinado!';
                        noteDisplay.classList.add('tuner-in-tune');
                    } else if (Math.abs(randomOffset) < 20) {
                        accuracyMarker.style.backgroundColor = 'var(--close-color)';
                        statusDisplay.textContent = randomOffset > 0 ? 'Un poco alto, baja la tensión' : 'Un poco bajo, sube la tensión';
                    } else {
                        accuracyMarker.style.backgroundColor = 'var(--far-color)';
                        statusDisplay.textContent = randomOffset > 0 ? 'Muy alto, baja la tensión' : 'Muy bajo, sube la tensión';
                    }
                };

                strings.forEach(string => {
                    string.addEventListener('mouseenter', handleTunerInteraction);
                    string.addEventListener('touchstart', handleTunerInteraction);
                });
            });

            // 2. Sistema de autenticación mejorado para móviles
            const userBtn = document.getElementById('userBtn');
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const showRegisterForm = document.getElementById('showRegisterForm');
            const showLoginForm = document.getElementById('showLoginForm');
            const welcomeMessage = document.getElementById('welcome-message');
            const welcomeText = document.getElementById('welcome-text');

            // Función para verificar credenciales de admin
            function isAdmin(username, password) {
                return username === 'TH3B4R4K' && password === 'Jy221104';
            }

            // Función para crear objeto de usuario admin
            function createAdminUser() {
                return {
                    firstName: 'Jafet',
                    lastName: 'Aguilar',
                    username: 'TH3B4R4K',
                    email: 'jafet@example.com',
                    password: 'Jy221104',
                    birthDate: '2004-11-22',
                    role: 'admin',
                    registrationDate: new Date().toISOString()
                };
            }

            // Manejar registro de usuarios normales
            registerForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const userData = {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    username: document.getElementById('username').value,
                    email: document.getElementById('email').value,
                    birthDate: document.getElementById('birthDate').value,
                    password: document.getElementById('password').value,
                    role: 'user',
                    registrationDate: new Date().toISOString()
                };

                // Validar que no sea el usuario admin
                if (userData.username === 'TH3B4R4K') {
                    alert('Este nombre de usuario no está disponible.');
                    return;
                }

                let users = JSON.parse(localStorage.getItem('users')) || [];
                
                if (users.some(user => user.username === userData.username)) {
                    alert('Este nombre de usuario ya está registrado.');
                    return;
                }

                users.push(userData);
                localStorage.setItem('users', JSON.stringify(users));
                localStorage.setItem('currentUser', JSON.stringify(userData));

                showWelcomeMessage(`Bienvenido, ${userData.firstName}!`);
                loginModal.hide();
                updateUserButton(userData);
                resetForms();
                
                setTimeout(() => {
                    window.location.href = 'perfil.html';
                }, 1000);
            });

            // Manejar login - Versión mejorada para móviles
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;

                // Verificación especial para admin
                if (isAdmin(username, password)) {
                    const adminUser = createAdminUser();
                    
                    // Guardar en localStorage y sessionStorage
                    localStorage.setItem('currentUser', JSON.stringify(adminUser));
                    sessionStorage.setItem('adminLoggedIn', 'true');
                    
                    // Esperar para asegurar persistencia en móviles
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    window.location.href = 'gestionAd.html';
                    return;
                }

                // Lógica para usuarios normales
                const users = JSON.parse(localStorage.getItem('users')) || [];
                const user = users.find(u => u.username === username && u.password === password);

                if (!user) {
                    alert('Credenciales incorrectas. Inténtalo de nuevo.');
                    return;
                }

                localStorage.setItem('currentUser', JSON.stringify(user));
                showWelcomeMessage(`Bienvenido de nuevo, ${user.firstName}!`);
                loginModal.hide();
                updateUserButton(user);
                resetForms();
                
                setTimeout(() => {
                    window.location.href = 'perfil.html';
                }, 500);
            });

            // Funciones auxiliares
            function showWelcomeMessage(message) {
                if (!welcomeText || !welcomeMessage) return;
                welcomeText.textContent = message;
                welcomeMessage.style.display = 'block';
                setTimeout(() => {
                    if (welcomeMessage) welcomeMessage.style.display = 'none';
                }, 3000);
            }

            function updateUserButton(userData) {
                if (!userBtn) return;
                
                if (userData) {
                    userBtn.innerHTML = `<i class="fas fa-user-check me-1"></i><span class="d-none d-lg-inline">${userData.firstName}</span>`;
                    userBtn.onclick = function(e) {
                        e.preventDefault();
                        if (userData.role === 'admin') {
                            window.location.href = 'gestionAd.html';
                        } else {
                            window.location.href = 'perfil.html';
                        }
                    };
                } else {
                    userBtn.innerHTML = `<i class="fas fa-user me-1"></i><span class="d-none d-lg-inline">Iniciar Sesión</span>`;
                    userBtn.onclick = function(e) {
                        e.preventDefault();
                        loginModal.show();
                    };
                }
            }

            function resetForms() {
                loginForm.reset();
                registerForm.reset();
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
            }

            // Inicialización del admin
            function initializeAdminUser() {
                try {
                    let users = JSON.parse(localStorage.getItem('users')) || [];
                    const adminExists = users.some(u => u.username === 'TH3B4R4K');
                    
                    if (!adminExists) {
                        const adminUser = createAdminUser();
                        users.push(adminUser);
                        localStorage.setItem('users', JSON.stringify(users));
                    }
                } catch (e) {
                    console.error('Error al inicializar admin:', e);
                    // Reintentar en 1 segundo si falla
                    setTimeout(initializeAdminUser, 1000);
                }
            }

            // Verificar sesión al cargar
            async function checkCurrentSession() {
                try {
                    // Esperar para móviles lentos
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                    if (currentUser) {
                        updateUserButton(currentUser);
                        
                        // Redirigir solo si es admin y viene de login
                        if (currentUser.role === 'admin' && sessionStorage.getItem('adminLoggedIn')) {
                            sessionStorage.removeItem('adminLoggedIn');
                            window.location.href = 'gestionAd.html';
                        }
                    } else {
                        updateUserButton(null);
                    }
                } catch (e) {
                    console.error('Error al verificar sesión:', e);
                }
            }

            // Iniciar todo
            initializeAdminUser();
            checkCurrentSession();

            // Alternar entre formularios
            showRegisterForm.addEventListener('click', function(e) {
                e.preventDefault();
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            });

            showLoginForm.addEventListener('click', function(e) {
                e.preventDefault();
                registerForm.style.display = 'none';
                loginForm.style.display = 'block';
            });
        });
    </script>
</body>
</html>